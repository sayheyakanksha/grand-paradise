---
import ListLayout from "@/layouts/list.astro";
import { getEntry } from "astro:content";
import { categoriesHandler } from "@/lib/handlers/categories";
import NewsCard from "@/components/cards/newsCard.astro";
import ArrowRight02 from "@/assets/svgs/arrow-right-02.astro";

const entry = await getEntry("views", "categories");

if (!entry) {
  return Astro.redirect("/404");
}

// Fetch all articles to extract categories
const articles = categoriesHandler.allCategoriesWithLatestArticles();
---

{/* Use your BaseLayout and pass the entry for metadata */}
<ListLayout header={"All Categories"} entry={entry}>
  <ul class="my-6 w-full space-y-8">
    {
      articles.map((category) => {
        const { path, title, latestArticles } = category.data;
        const articleCount = category.data.count;
        return (
          <div class="flex flex-col items-start gap-4">
            <div class="border-accent/30 flex w-full items-center justify-between gap-2 border-b">
              <h2 class="inline-flex items-center text-xl">
                {title}{" "}
                <span class="text-primary ml-2 font-sans text-xs">
                  ({articleCount} Articles)
                </span>
              </h2>
              <a
                href={`/categories/${path}/1`}
                class="group flex items-center gap-1 text-sm transition-all duration-200 hover:gap-2"
              >
                See All
                <span class="transform transition-transform duration-200 group-hover:translate-x-1">
                  <ArrowRight02 size="16" />
                </span>
              </a>
            </div>
            <div class="snap-x">
              {/* {latestArticles.slice(0, 6).map((article, index) => (
                <NewsCard article={article} index={index} />
              ))} */}
              <div class="flex snap-x snap-proximity space-x-4 overflow-x-auto pb-4">
                {latestArticles.slice(0, 6).map((article, index) => (
                  <div class="flex-none snap-start lg:flex-initial">
                    <NewsCard article={article} index={index} />
                  </div>
                ))}
              </div>
            </div>
          </div>
        );
      })
    }
  </ul>
</ListLayout>
